# Nethack Report

###一、代码运行方法

打开头目录下的exe文件即可运行游戏



###二、游戏说明

####概述

1987年经典单人冒险探索游戏NetHack，简单模仿。

随机地图生成，怪物装备道具随机，进入十层拿到项链即可胜利。

####地图

玩家 `@`

怪物 `M` `N`

道具 `R` `B` `W` `I` `$` `&` 

墙壁 `#`

门 `/` `` `

地板/道路 `.`

楼梯 `<` `>`

####操作

具有八方向移动`WSADQEZC`，八方向攻击`K`，开门`O`，拾取`J`、使用道具`12345`，

上下楼层`U`，治疗`H`，休息`R`，切换事件/背包查看`L`，以及切换正常/开挂模式`G`

#### 玩家/怪物说明

玩家初始`HP 50` `MP 5` `ATK 8`

怪物初始`HP 16` `ATK 3`

玩家通过刷怪升级增加属性，怪物通过自身存在时长自动提升属性。



### 三、设计思路

####代码架构

这个项目只是不是太严谨的分为了两层：UI层、逻辑层

UI层主要处理玩家操作后事件和状态的改变（游戏界面中的右侧部分）

逻辑层执行UI层传入的操作，更新数据并实时更新地图状态（游戏界面中左侧部分）

各类相对分离，上层依赖下层，上层控制下层，避免相互依赖。

####部分巧妙设计

- **Direction类**

  Direction类内部储存八个方向对应的dx, dy值，外部传入0-7的任一数字即可构造Direction对象，同时改变Direction也只需要改变该特定数值。

  重载了 **++  --** 运算符，方便实现方向的改变。


- **Pos类**（position）**和Direction类**

  重载了 **==  !=** 运算符以便判断坐标位置是否相同。

  重载了 **Pos + Direction** 的操作以便实现坐标的移动。

- **Item类**

  Item类同样采取了Direction的方法内部储存物品的符号、名字、属性加成等信息，外部传入一个数字构造对应物品种类，通过物品对应数字获取物品其他信息。

  ​



### 四、拓展点

#### 地图随机和分层

游戏中的每一层地图规定为3*3的九个小房间，规定房间最大尺寸，房间尺寸及位置随机，安放至地图的九个“大格”中，房间四周随机生成门口（随机开闭），地图将相连两个房间的门口以随机路径连接起来（遵循路径最短原则），再随机放置物品及上下楼梯即完成单层地图的生成。

玩家通过可以操作更换楼层。

#### 怪物随机生成和自动寻址

广度优先算法的实现

####视野系统和攻击反馈

默认视野范围为以玩家为中心7*7的方阵，遇到墙壁和关闭的门视野则会被阻挡。

玩家攻击或被攻击时有攻击反馈。

#### 显示/隐藏怪物

玩家可根据需要改变游戏是否显示怪物轨迹的设定，增加玩家的决定权。

#### 玩家/怪物自动恢复机制

玩家和怪物各自存在一个recover_count_变量来控制属性的变化。

玩家和怪物的HP会随回合自动恢复，玩家MP会随回合自动恢复。

怪物HP和ATK随着**其存在回合数**增加而适当增加，适当增加游戏难度和可玩性。



2017级 数据科学学院 软件工程 梁文杰 16303050